<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ================= LIST VIEW ================= -->
    <record id="view_attendance_list_inherit" model="ir.ui.view">
        <field name="name">hr.attendance.list.forher</field>
        <field name="model">hr.attendance</field>
        <field name="inherit_id" ref="hr_attendance.view_attendance_tree"/>
        <field name="arch" type="xml">
        <!-- Ẩn validated_overtime_hours -->
        <xpath expr="//field[@name='validated_overtime_hours']" position="replace"/>
        <!-- Ẩn overtime_hours -->
        <xpath expr="//field[@name='overtime_hours']" position="replace"/>

        <!-- Ẩn cột Worked Hours -->
        <xpath expr="//field[@name='worked_hours']" position="attributes">
            <attribute name="invisible">1</attribute>
        </xpath>
        
            <field name="employee_id" position="after">
                <field name="branch_id"/>
            </field>
            <field name="worked_hours" position="after">
                <field name="attendance_type_id"/>
                <field name="recorded_by"/>
                <field name="is_late"/>
                <field name="is_early"/>
                <field name="is_holiday"/>
                <field name="quantity" string="Tổng giờ làm"/>
                <field name="ot_hours_normal" string="OT thường"/>
                <field name="ot_hours_holiday" string="OT ngày lễ"/>
                <field name="state" widget="badge"
                       decoration-success="state == 'validated'"
                       decoration-warning="state == 'confirmed'"
                       decoration-danger="state == 'rejected'"
                       decoration-muted="state == 'draft'"/>
            </field>
        </field>
    </record>



     <record id="view_attendance_form_inherit" model="ir.ui.view">
        <field name="name">hr.attendance.form.forher</field>
        <field name="model">hr.attendance</field>
        <field name="inherit_id" ref="hr_attendance.hr_attendance_view_form"/>
        <field name="arch" type="xml">

             <xpath expr="//field[@name='overtime_status']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='overtime_status']" position="replace"/>
            <xpath expr="//button[@name='action_approve_overtime']" position="replace"/>
            <xpath expr="//button[@name='action_refuse_overtime']" position="replace"/>
            <!-- Ẩn validated_overtime_hours -->
            <xpath expr="//field[@name='validated_overtime_hours']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <!-- Ẩn worked_hours -->
            <xpath expr="//field[@name='worked_hours']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <header>
                <!-- Thanh trạng thái -->
                <field name="state" widget="statusbar"
                    options="{'draft':'secondary',
                            'to_confirm':'blue',
                            'confirmed':'purple',
                            'validated':'green',
                            'rejected':'red'}"/>

                <!-- draft -->
                <button name="action_send_to_confirm" string="Gửi xác nhận" type="object"
                        class="btn-primary btn-dynamic"
                        groups="forher_company_overview.forher_group_employee,base.group_system"
                        invisible="state != 'draft'"/>

                <!-- to_confirm -->
                <button name="action_confirm" string="Xác nhận" type="object"
                        class="btn-info btn-dynamic"
                        groups="forher_company_overview.forher_group_branch_manager,forher_company_overview.forher_group_board,base.group_system"
                        invisible="state != 'to_confirm'"/>

                <!-- confirmed -->
                <button name="action_validate" string="Duyệt" type="object"
                        class="btn-success btn-dynamic"
                        groups="forher_company_overview.forher_group_branch_manager,forher_company_overview.forher_group_board,base.group_system"
                        invisible="state != 'confirmed'"/>
                <button name="action_reject" string="Từ chối" type="object"
                        class="btn-danger btn-dynamic"
                        groups="forher_company_overview.forher_group_branch_manager,forher_company_overview.forher_group_board,base.group_system"
                        invisible="state != 'confirmed'"/>

                <!-- validated hoặc rejected -->
                <button name="action_set_draft" string="Đặt về Nháp" type="object"
                        class="btn-secondary btn-dynamic"
                        groups="base.group_system"
                        invisible="state != 'validated' and state != 'rejected'"/>

            </header>


            <!-- Khóa các field cơ bản -->
            <xpath expr="//field[@name='employee_id']" position="after">
                <field name="branch_id" readonly="1"/>
                <field name="parent_company_id" readonly="1"/>
                <field name="contract_type_id" readonly="1"/>
                <field name="date" readonly="1"/>
                <field name="is_holiday"/>
            </xpath>

            <!-- Thêm nhóm Công & Loại công và Người ghi nhận -->
        <xpath expr="//sheet/group[1]" position="after">
            <group string="Công &amp; Loại công">
                <field name="attendance_type_id"/>
                <field name="worked_hours_float" string="Số giờ làm"/>
                <field name="ot_hours_normal" string="OT thường"/>
                <field name="ot_hours_holiday" string="OT ngày lễ"/>
                <field name="quantity" string="Tổng công"/>
                <field name="is_late"/>
                <field name="is_early"/>
            </group>
            <group string="Người ghi nhận">
                <field name="recorded_by"/>
                <field name="is_public"/>
            </group>
        </xpath>

        </field>
    </record>

    <!-- ================= ACTION ================= -->
    <record id="hr_attendance_action" model="ir.actions.act_window">
        <field name="name">Chấm công</field>
        <field name="res_model">hr.attendance</field>
        <field name="view_mode">tree,form</field>
    </record>

</odoo>
